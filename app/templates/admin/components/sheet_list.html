<div
  class="relative"
  x-data="{
        search: '',
        filterStatus: 'all',
        get filteredSheets() {
          return this.sheets.filter(s => {
            // Calculate days since last modified
            let days = s.last_modified_dt 
              ? (new Date() - new Date(s.last_modified_dt)) / (1000*60*60*24) 
              : Infinity;

            // Determine status
            let status = days <= 1 ? 'updated' : days <= 3 ? 'recently' : 'outdated';

            // Filter by status
            if (this.filterStatus !== 'all' && this.filterStatus !== status) return false;

            // Search by query
            let query = this.search.toLowerCase();
            return (
              s.name?.toLowerCase().includes(query) ||
              s.modified_by?.toLowerCase().includes(query) ||
              s.modified_email?.toLowerCase().includes(query) ||
              (s.tabs || []).some(t => t.toLowerCase().includes(query))
            );
          });
        }
     }"
>
  <!-- Sheets Grid -->
  <div
    x-show="activeTab==='list'"
    x-transition
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-white p-2"
  >
    <div
      class="col-span-1 md:col-span-3 flex flex-col md:flex-row items-center justify-between"
    >
      <h1
        class="text-2xl font-bold text-green-700 flex items-center gap-1 w-[300px]"
      >
        <i data-lucide="list"></i> Sheet List
      </h1>

      <!-- Filters + Search -->
      <div
        class="flex flex-wrap items-center gap-2 rounded-md w-full"
      >
        <!-- Search -->
        <input
          type="text"
          placeholder="Search sheets..."
          x-model="search"
          class="w-full sm:w-1/3 border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-green-500"
        />

        <!-- Filter Dropdown -->
        <select
          x-model="filterStatus"
          class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-green-500"
        >
          <option value="all">All</option>
          <option value="updated">Updated</option>
          <option value="recently">Recently</option>
          <option value="outdated">Outdated</option>
        </select>

        <!-- Legend -->
        <div class="flex items-center gap-2 ml-auto text-xs font-medium">
          <span class="px-2 py-1 rounded-full bg-green-600 text-white"
            >Updated</span
          >
          <span class="px-2 py-1 rounded-full bg-yellow-600 text-white"
            >Recently</span
          >
          <span class="px-2 py-1 rounded-full bg-red-600 text-white"
            >Outdated</span
          >
        </div>
      </div>
    </div>

    <!-- Loop filteredSheets -->
    <template x-for="s in filteredSheets" :key="s.id">
      <div
        class="bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-2xl hover:scale-[1.03] transition-transform duration-300 flex flex-col overflow-hidden"
      >
        <!-- Header -->
        <div
          class="px-6 py-3 border-b bg-gradient-to-r from-green-600 to-green-500 text-white flex items-center space-x-3"
        >
          <i data-lucide="file-text" class="lucide w-7 h-7 shrink-0"></i>
          <h3
            class="text-lg md:text-xl font-bold truncate"
            x-text="s.name"
          ></h3>
        </div>

        <!-- Content -->
        <div
          class="p-6 flex-1 flex flex-col text-gray-700 text-sm overflow-hidden space-y-6"
        >
          <!-- Group 1: Sheet Info -->
          <div class="space-y-3">
            <div
              class="flex items-center justify-between border-b border-gray-200 pb-2"
            >
              <h4 class="font-semibold text-gray-800 text-sm">Sheet Info</h4>
              <span
                :class="{
                  'bg-green-600 text-white': s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=1,
                  'bg-yellow-600 text-white': s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)>1 && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=3,
                  'bg-red-600 text-white': !s.last_modified_dt || (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)>3
                }"
                class="px-3 py-1 text-xs md:text-sm rounded-full font-medium shadow-sm whitespace-nowrap flex items-center gap-1"
              >
                <template
                  x-if="s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=1"
                >
                  <i data-lucide="check-circle" class="w-4 h-4"></i>
                </template>
                <template
                  x-if="s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)>1 && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=3"
                >
                  <i data-lucide="alert-circle" class="w-4 h-4"></i>
                </template>
                <template
                  x-if="!s.last_modified_dt || (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)>3"
                >
                  <i data-lucide="x-circle" class="w-4 h-4"></i>
                </template>
                <span
                  x-text="s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=1 ? 'Updated' : s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=3 ? 'Recently' : 'Outdated'"
                ></span>
              </span>
            </div>

            <!-- Last Modified -->
            <div class="flex items-center space-x-2">
              <i
                data-lucide="calendar"
                class="lucide w-5 h-5 text-green-600"
              ></i>
              <div class="flex flex-col">
                <span class="font-medium text-gray-700">Last Modified</span>
                <span
                  x-text="s.last_modified_dt ? new Date(s.last_modified_dt).toLocaleString() : '-'"
                  :class="{
                    'text-green-700': s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=1,
                    'text-yellow-600': s.last_modified_dt && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)>1 && (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)<=3,
                    'text-red-600': !s.last_modified_dt || (new Date()-new Date(s.last_modified_dt))/(1000*60*60*24)>1
                  }"
                ></span>
              </div>
            </div>

            <!-- Modified By -->
            <div class="flex items-center space-x-2">
              <i
                data-lucide="user"
                class="lucide w-5 h-5 text-green-600 shrink-0"
              ></i>
              <div class="flex flex-col">
                <span class="font-medium text-gray-700">Modified By</span>
                <span x-text="s.modified_by || '-'"></span>
              </div>
            </div>

            <!-- Email -->
            <div class="flex items-center space-x-2">
              <i
                data-lucide="mail"
                class="lucide w-5 h-5 text-green-600 shrink-0"
              ></i>
              <div class="flex flex-col">
                <span class="font-medium text-gray-700">Email</span>
                <span x-text="s.modified_email || '-'"></span>
              </div>
            </div>
          </div>

          <!-- Tabs -->
          <div>
            <h4
              class="font-semibold text-gray-800 border-b border-gray-200 pb-1 mb-2 text-sm"
            >
              Tabs
            </h4>
            <div class="flex flex-wrap gap-2">
              <!-- Show only first 5 tabs -->
              <template
                x-for="(tab, index) in (s.tabs || []).slice(0,5)"
                :key="tab"
              >
                <span
                  class="px-2 py-1 bg-green-700 text-white rounded-md text-xs font-medium"
                  x-text="tab"
                ></span>
              </template>

              <!-- If there are more than 5, show +N more -->
              <template x-if="s.tabs && s.tabs.length > 5">
                <span
                  class="px-2 py-1 bg-gray-300 text-gray-700 rounded-md text-xs font-medium"
                >
                  +<span x-text="s.tabs.length - 5"></span> more
                </span>
              </template>
            </div>
          </div>

          <!-- Actions -->
          <div>
            <h4
              class="font-semibold text-gray-800 border-b border-gray-200 pb-1 mb-2 text-sm"
            >
              Actions
            </h4>
            <div class="flex justify-end gap-2 items-center">
              <button
                @click="openHistory(s)"
                class="bg-gray-200 rounded-md p-2 text-sm text-blue-600 hover:text-blue-800 hover:underline font-semibold transition-colors"
              >
                View History
              </button>
              <a
                :href="s.url"
                target="_blank"
                class="bg-green-700 rounded-md p-1 text-white hover:bg-green-800 font-semibold text-sm md:text-base transition-colors"
                >Open</a
              >
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
</div>
